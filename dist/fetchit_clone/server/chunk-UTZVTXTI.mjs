import './polyfills.server.mjs';
import{a as P,b as A,c,d as D,e as k,i as N,j as R,k as L,l as U,m as G,n as q,o as j,p as $,q as z,r as B,s as H,t as K,u as Y}from"./chunk-MJ3RF4KC.mjs";import{i as F,j as I,k as O,m as M}from"./chunk-U4YU66BB.mjs";import{Ab as b,Bb as x,Eb as T,Lb as n,Mb as p,Nb as w,Ta as o,Vb as V,Ya as S,ab as E,da as v,ea as h,fb as _,nb as u,sb as t,tb as e,ub as s,xb as C}from"./chunk-SO2YPVB3.mjs";import"./chunk-H4UZCO6D.mjs";var W=(l,i)=>({"text-green-600":l,"text-red-600":i});function Q(l,i){if(l&1){let r=C();t(0,"button",38),b("click",function(){v(r);let d=x().$implicit,f=x();return h(f.disableCoupon(d))}),n(1,"Disable"),e()}}function X(l,i){if(l&1){let r=C();t(0,"button",39),b("click",function(){v(r);let d=x().$implicit,f=x();return h(f.enableCoupon(d))}),n(1,"Enable"),e()}}function Z(l,i){if(l&1){let r=C();t(0,"tr",26)(1,"td",27),n(2),e(),t(3,"td",28),n(4),e(),t(5,"td",21),n(6),e(),t(7,"td",21),n(8),e(),t(9,"td",21),n(10),e(),t(11,"td",21),n(12),e(),t(13,"td",21),n(14),e(),t(15,"td",21),n(16),e(),t(17,"td",21),n(18),e(),t(19,"td",21),n(20),e(),t(21,"td",21),n(22),e(),t(23,"td",21),n(24),e(),t(25,"td",21)(26,"span",29),n(27),e()(),t(28,"td",21),_(29,Q,2,0,"button",30)(30,X,2,0,"button",31),e(),t(31,"td",32)(32,"button",33),b("click",function(){let d=v(r).$implicit,f=x();return h(f.showEditForm(d))}),n(33,"Edit"),e()(),t(34,"td")(35,"button",34),b("click",function(){let d=v(r).$implicit,f=x();return h(f.deleteCoupon(d))}),n(36,"Delete"),e()(),t(37,"td",35)(38,"button",36),b("click",function(){let d=v(r).$implicit,f=x();return h(f.openAuditLog(d))}),s(39,"i",37),e()()()}if(l&2){let r=i.$implicit,a=x();o(2),p(r.code),o(),T("title",r.description),o(),p(a.short(r.description)),o(2),p(r.couponType),o(2),p(r.createdFor),o(2),p(r.minOrderPrice),o(2),p(a.formatDate(r.startTime)),o(2),p(a.formatDate(r.endTime)),o(2),p(r.maxRedemption),o(2),p(r.redemptionCount),o(2),p(r.perUserLimit),o(2),p(r.discountType),o(2),p(a.formatDate(r.createdOn)),o(2),u("ngClass",V(17,W,r.status==="active",r.status==="inactive")),o(),w(" ",r.status," "),o(2),u("ngIf",!r.isDisabled),o(),u("ngIf",r.isDisabled)}}function ee(l,i){l&1&&(t(0,"tr")(1,"td",40),n(2,"No coupons found"),e()())}function te(l,i){l&1&&(t(0,"div",67),n(1,"Required"),e())}function ie(l,i){if(l&1&&(t(0,"option",68),n(1),e()),l&2){let r=i.$implicit;u("value",r),o(),p(r)}}function ne(l,i){l&1&&(t(0,"div",67),n(1,"Required"),e())}function re(l,i){l&1&&(t(0,"div",67),n(1,"Required"),e())}function oe(l,i){l&1&&(t(0,"div"),s(1,"input",69),e())}function le(l,i){l&1&&(t(0,"div"),s(1,"input",70),e())}function ae(l,i){if(l&1){let r=C();t(0,"div",41)(1,"div",42)(2,"form",43),b("ngSubmit",function(){v(r);let d=x();return h(d.saveCoupon())}),t(3,"div",44)(4,"div")(5,"h2",45),n(6,"Coupon Information"),e(),t(7,"label"),n(8,"Coupon Code"),e(),s(9,"input",46),_(10,te,2,0,"div",47),t(11,"label"),n(12,"Store Type"),e(),t(13,"select",48)(14,"option",49),n(15,"Select Store Type"),e(),_(16,ie,2,2,"option",50),e(),_(17,ne,2,0,"div",47),e(),t(18,"div")(19,"h2",45),n(20,"Description"),e(),s(21,"input",51),_(22,re,2,0,"div",47),t(23,"div",52)(24,"label",53),n(25,"Coupon For First Order"),e(),s(26,"input",54),e()()(),t(27,"div",44)(28,"div")(29,"h2",45),n(30,"Coupon Validation"),e(),s(31,"input",55),e(),t(32,"div"),s(33,"input",56),e()(),t(34,"div",44)(35,"div")(36,"h2",57),n(37,"Discount Type"),e(),t(38,"div",58)(39,"label"),s(40,"input",59),n(41," Percentage Value"),e(),t(42,"label"),s(43,"input",60),n(44," Fixed Value"),e()(),_(45,oe,2,0,"div",23)(46,le,2,0,"div",23),t(47,"label"),n(48,"Minimum Order Price"),e(),s(49,"input",61),e(),t(50,"div")(51,"h2",57),n(52,"Limits & Redemption"),e(),t(53,"label"),n(54,"Max Per User"),e(),s(55,"input",62),t(56,"label"),n(57,"Max Redemption"),e(),s(58,"input",63),e()(),t(59,"div",64)(60,"button",65),b("click",function(){v(r);let d=x();return h(d.cancelForm())}),n(61,"Cancel"),e(),t(62,"button",66),n(63,"Submit"),e()()()()()}if(l&2){let r,a,d,f,g,m=x();o(2),u("formGroup",m.form),o(8),u("ngIf",((r=m.form.get("code"))==null?null:r.invalid)&&((r=m.form.get("code"))==null?null:r.touched)),o(6),u("ngForOf",m.storeTypes),o(),u("ngIf",((a=m.form.get("storeType"))==null?null:a.invalid)&&((a=m.form.get("storeType"))==null?null:a.touched)),o(5),u("ngIf",((d=m.form.get("description"))==null?null:d.invalid)&&((d=m.form.get("description"))==null?null:d.touched)),o(23),u("ngIf",((f=m.form.get("discountType"))==null?null:f.value)==="percentage"),o(),u("ngIf",((g=m.form.get("discountType"))==null?null:g.value)==="fixed")}}function de(l,i){if(l&1){let r=C();t(0,"div",71)(1,"div",72)(2,"div",73)(3,"h2",74),n(4,"Audit Log"),e(),t(5,"button",75),b("click",function(){v(r);let d=x();return h(d.closeAuditLog())}),s(6,"i",76),e()(),t(7,"table",77)(8,"tr")(9,"td")(10,"b"),n(11,"Coupon Code:"),e()(),t(12,"td"),n(13),e()(),t(14,"tr")(15,"td")(16,"b"),n(17,"Description:"),e()(),t(18,"td"),n(19),e()(),t(20,"tr")(21,"td")(22,"b"),n(23,"Created On:"),e()(),t(24,"td"),n(25),e()(),t(26,"tr")(27,"td")(28,"b"),n(29,"Status:"),e()(),t(30,"td"),n(31),e()()(),t(32,"div",78)(33,"button",79),b("click",function(){v(r);let d=x();return h(d.closeAuditLog())}),n(34,"Close"),e()()()()}if(l&2){let r=x();o(13),p(r.selectedAudit.code),o(6),p(r.selectedAudit.description),o(6),p(r.formatDate(r.selectedAudit.createdOn)),o(6),p(r.selectedAudit.status)}}var J=class l{constructor(i){this.fb=i}filterForm;form;coupons=[];filteredCoupons=[];storeTypes=["GROCERY","BEVERAGES","RETAIL"];showForm=!1;editingCoupon=null;showAuditModal=!1;selectedAudit=null;ngOnInit(){this.filterForm=this.fb.group({status:["Active"],type:["All"],code:[""],from:[""],to:[""]}),this.form=this.fb.group({code:["",c.required],description:["",c.required],storeType:["",c.required],createdFor:["",c.required],minOrderPrice:[1,c.required],startTime:["",c.required],endTime:["",c.required],discountType:["percentage",c.required],percentageValue:[{value:null,disabled:!1},[c.min(1),c.max(100)]],fixedValue:[{value:null,disabled:!0},c.min(1)],maxRedemption:[1,[c.required,c.min(0)]],perUserLimit:[1,[c.required,c.min(1)]],isFirstOrder:[!1]}),this.form.get("discountType")?.valueChanges.subscribe(i=>{i==="percentage"?(this.form.get("percentageValue")?.enable(),this.form.get("fixedValue")?.disable(),this.form.get("fixedValue")?.setValue(null)):(this.form.get("percentageValue")?.disable(),this.form.get("fixedValue")?.enable(),this.form.get("percentageValue")?.setValue(null))}),this.loadCoupons(),this.applyFilters(),this.filterForm.valueChanges.subscribe(()=>this.applyFilters())}loadCoupons(){let i=localStorage.getItem("coupons");i?this.coupons=JSON.parse(i):(this.coupons=this.getDemoCoupons(),this.saveCoupons())}saveCoupons(){localStorage.setItem("coupons",JSON.stringify(this.coupons))}getDemoCoupons(){return[{id:1,code:"NEWUSER101",description:"10% discount for new users",createdOn:1745721615,couponType:"coupon",storeType:"GROCERY",createdFor:"PK General Store",minOrderPrice:1e3,startTime:1745721600,endTime:1745894400,maxRedemption:1,redemptionCount:1,perUser:1,perUserLimit:1,discountType:"percentage",percentageValue:10,fixedValue:null,status:"active",isFirstOrder:!0,isDisabled:!1},{id:2,code:"KHURANA60",description:"60rs discount on minimum 160",createdOn:1745529635,couponType:"coupon",storeType:"GROCERY",createdFor:"Khurana Grocers",minOrderPrice:160,startTime:1745529600,endTime:1745721600,maxRedemption:5,redemptionCount:2,perUser:1,perUserLimit:1,discountType:"fixed",percentageValue:null,fixedValue:60,status:"active",isFirstOrder:!1,isDisabled:!1}]}applyFilters(){let{status:i,type:r,code:a,from:d,to:f}=this.filterForm.value,g=[...this.coupons];if(i&&i!=="All"&&(g=g.filter(m=>m.status.toLowerCase()===i.toLowerCase())),r&&r!=="All"&&(g=g.filter(m=>m.couponType===r)),a&&(g=g.filter(m=>m.code.toLowerCase().includes(a.toLowerCase()))),d){let m=new Date(d).setHours(0,0,0,0)/1e3;g=g.filter(y=>y.startTime>=m)}if(f){let m=new Date(f).setHours(23,59,59,999)/1e3;g=g.filter(y=>y.endTime<=m)}this.filteredCoupons=g}showAddForm(){this.showForm=!0,this.editingCoupon=null,this.form.reset(),this.form.patchValue({discountType:"percentage",minOrderPrice:1,perUserLimit:1,maxRedemption:1,isFirstOrder:!1})}showEditForm(i){this.showForm=!0,this.editingCoupon=i,this.form.patchValue({code:i.code,description:i.description,storeType:i.storeType,createdFor:i.createdFor,minOrderPrice:i.minOrderPrice,startTime:new Date(i.startTime*1e3).toISOString().slice(0,10),endTime:new Date(i.endTime*1e3).toISOString().slice(0,10),discountType:i.discountType,percentageValue:i.percentageValue,fixedValue:i.fixedValue,maxRedemption:i.maxRedemption,perUserLimit:i.perUserLimit,isFirstOrder:i.isFirstOrder}),i.discountType==="percentage"?(this.form.get("percentageValue")?.enable(),this.form.get("fixedValue")?.disable()):(this.form.get("percentageValue")?.disable(),this.form.get("fixedValue")?.enable())}saveCoupon(){if(this.form.invalid){this.form.markAllAsTouched();return}let i=this.form.value,r={id:this.editingCoupon?this.editingCoupon.id:Date.now(),code:i.code,description:i.description,couponType:"coupon",storeType:i.storeType,createdFor:i.createdFor,minOrderPrice:i.minOrderPrice,startTime:Math.floor(new Date(i.startTime).getTime()/1e3),endTime:Math.floor(new Date(i.endTime).getTime()/1e3),maxRedemption:i.maxRedemption,redemptionCount:this.editingCoupon?this.editingCoupon.redemptionCount:0,perUser:i.perUserLimit,perUserLimit:i.perUserLimit,discountType:i.discountType,percentageValue:i.discountType==="percentage"?i.percentageValue:null,fixedValue:i.discountType==="fixed"?i.fixedValue:null,status:this.editingCoupon?this.editingCoupon.status:"active",isFirstOrder:i.isFirstOrder,isDisabled:!1,createdOn:this.editingCoupon?this.editingCoupon.createdOn:Math.floor(Date.now()/1e3)};if(this.editingCoupon){let a=this.coupons.findIndex(d=>d.id===this.editingCoupon.id);this.coupons[a]=r}else this.coupons.push(r);this.saveCoupons(),this.applyFilters(),this.showForm=!1,this.editingCoupon=null}cancelForm(){this.showForm=!1,this.editingCoupon=null}deleteCoupon(i){confirm(`Are you sure you want to delete coupon "${i.code}"?`)&&(this.coupons=this.coupons.filter(r=>r.id!==i.id),this.saveCoupons(),this.applyFilters())}disableCoupon(i){i.status="inactive",i.isDisabled=!0,this.saveCoupons(),this.applyFilters()}enableCoupon(i){i.status="active",i.isDisabled=!1,this.saveCoupons(),this.applyFilters()}openAuditLog(i){this.selectedAudit=i,this.showAuditModal=!0}closeAuditLog(){this.selectedAudit=null,this.showAuditModal=!1}formatDate(i){return i?new Date(i*1e3).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"numeric",minute:"2-digit",hour12:!0}):""}short(i,r=20){return i?i.length>r?i.substring(0,r)+"...":i:""}static \u0275fac=function(r){return new(r||l)(S(H))};static \u0275cmp=E({type:l,selectors:[["app-promo-management"]],decls:68,vars:5,consts:[[1,"min-h-screen","bg-gray-50"],[1,"flex","justify-between","items-center","bg-white","shadow-sm","border-b","px-6","py-4","mb-6"],[1,"text-xl","font-semibold"],[1,"bg-red-600","text-white","px-4","py-2","rounded","hover:bg-red-700",3,"click"],[1,"fas","fa-plus","mr-2"],[1,"flex","flex-wrap","gap-3","mb-4",3,"formGroup"],["formControlName","status",1,"flex-1/1","border","rounded","px-3","py-1","text-gray-700"],["value","Active"],["value","Inactive"],["value","All"],["formControlName","type",1,"flex-1/1","border","rounded","px-3","py-1","text-gray-700"],["value","coupon"],["value","promo"],["formControlName","code","placeholder","Enter coupon code",1,"flex-1/1","border","rounded","px-3","py-1","w-56"],["type","date","formControlName","from",1,"flex-1/1","border","rounded","px-3","py-1","text-gray-700"],["type","date","formControlName","to",1,"flex-1/1","border","rounded","px-3","py-1","text-gray-700"],["type","button",1,"flex-1/1","rounded","border","border-blue-400","px-3","py-1","text-blue-600","hover:bg-blue-100",3,"click"],[1,"fas","fa-sync-alt"],[1,"overflow-auto","border","border-gray-300","rounded","shadow"],[1,"min-w-full","divide-y","divide-gray-200","text-sm"],[1,"bg-gray-50","text-gray-500","font-semibold"],[1,"p-2"],["class","border-b border-red-300",4,"ngFor","ngForOf"],[4,"ngIf"],["class","fixed inset-0 bg-gray-300 bg-opacity-40 flex items-center justify-center z-50",4,"ngIf"],["class","fixed inset-0 bg-gray-300 bg-opacity-50 flex items-center justify-center z-50",4,"ngIf"],[1,"border-b","border-red-300"],[1,"p-2","font-semibold"],[1,"p-2",3,"title"],[1,"capitalize",3,"ngClass"],["class","bg-yellow-400 text-black px-3 py-1 rounded hover:bg-yellow-500",3,"click",4,"ngIf"],["class","bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700",3,"click",4,"ngIf"],[1,"p-2","space-x-2"],[1,"bg-blue-600","text-white","px-3","py-1","rounded","hover:bg-blue-700",3,"click"],[1,"bg-red-600","text-white","px-3","py-1","rounded","hover:bg-red-700",3,"click"],[1,"p-2","text-center"],["title","Audit Logs",1,"hover:text-gray-700",3,"click"],[1,"fas","fa-file"],[1,"bg-yellow-400","text-black","px-3","py-1","rounded","hover:bg-yellow-500",3,"click"],[1,"bg-green-600","text-white","px-3","py-1","rounded","hover:bg-green-700",3,"click"],["colspan","16",1,"text-center","p-6","text-gray-400"],[1,"fixed","inset-0","bg-gray-300","bg-opacity-40","flex","items-center","justify-center","z-50"],[1,"bg-white","rounded-xl","shadow-lg","p-10","w-full","max-w-5xl","max-h-[90vh]","overflow-y-auto","relative"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-2","gap-8"],[1,"font-semibold","mb-2"],["formControlName","code","placeholder","Coupon Code",1,"w-full","border-b","p-1","mb-3"],["class","text-red-600 text-sm",4,"ngIf"],["formControlName","storeType",1,"w-full","border","p-1","mb-3","rounded"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","description","placeholder","Description",1,"w-full","border-b","p-1","mb-3"],[1,"flex","items-center","mb-5"],[1,"mr-3"],["type","checkbox","formControlName","isFirstOrder",1,"w-5","h-5"],["formControlName","startTime","type","date",1,"w-full","border","p-1","mb-5","rounded"],["formControlName","endTime","type","date",1,"w-full","border","p-1","mb-5","rounded"],[1,"font-semibold","mb-3"],[1,"flex","space-x-5"],["type","radio","formControlName","discountType","value","percentage"],["type","radio","formControlName","discountType","value","fixed"],["type","number","formControlName","minOrderPrice","placeholder","Minimum Order Price","min","1",1,"w-full","border","p-1","rounded"],["type","number","formControlName","perUserLimit","min","1",1,"w-full","border","p-1","rounded","mb-5"],["type","number","formControlName","maxRedemption","min","0",1,"w-full","border","p-1","rounded"],[1,"flex","justify-end","mt-10"],["type","button",1,"px-6","py-2","border","rounded","border-gray-300","mr-4","hover:bg-gray-100",3,"click"],["type","submit",1,"bg-black","text-white","px-6","py-2","rounded","hover:bg-gray-900"],[1,"text-red-600","text-sm"],[3,"value"],["type","number","formControlName","percentageValue","placeholder","Percentage Value","min","1","max","100",1,"w-full","border","p-1","rounded","my-3"],["type","number","formControlName","fixedValue","placeholder","Fixed Value","min","1",1,"w-full","border","p-1","rounded","my-3"],[1,"fixed","inset-0","bg-gray-300","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"bg-white","rounded","p-8","max-w-lg","w-full","max-h-[80vh]","overflow-y-auto"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-lg","font-bold"],[1,"text-gray-600",3,"click"],[1,"fas","fa-times"],[1,"w-full","text-sm"],[1,"mt-6","text-right"],[1,"px-5","py-2","border","rounded","border-gray-300","hover:bg-gray-100",3,"click"]],template:function(r,a){r&1&&(t(0,"div",0)(1,"div",1)(2,"h1",2),n(3,"List of Coupon"),e(),t(4,"button",3),b("click",function(){return a.showAddForm()}),s(5,"i",4),n(6,"Add Coupon "),e()(),t(7,"form",5)(8,"select",6)(9,"option",7),n(10,"Active"),e(),t(11,"option",8),n(12,"Inactive"),e(),t(13,"option",9),n(14,"All"),e()(),t(15,"select",10)(16,"option",9),n(17,"All Type"),e(),t(18,"option",11),n(19,"Coupon"),e(),t(20,"option",12),n(21,"Promo"),e()(),s(22,"input",13)(23,"input",14)(24,"input",15),t(25,"button",16),b("click",function(){return a.applyFilters()}),s(26,"i",17),e()(),t(27,"div",18)(28,"table",19)(29,"thead")(30,"tr",20)(31,"th",21),n(32,"Coupon Code"),e(),t(33,"th",21),n(34,"Description"),e(),t(35,"th",21),n(36,"Coupon Type"),e(),t(37,"th",21),n(38,"Created For"),e(),t(39,"th",21),n(40,"Min Order Price"),e(),t(41,"th",21),n(42,"Start Time"),e(),t(43,"th",21),n(44,"End Time"),e(),t(45,"th",21),n(46,"Max Redemption"),e(),t(47,"th",21),n(48,"Redemption Count"),e(),t(49,"th",21),n(50,"Per User Limit"),e(),t(51,"th",21),n(52,"Discount Type"),e(),t(53,"th",21),n(54,"Created On"),e(),t(55,"th",21),n(56,"Status"),e(),t(57,"th",21),n(58,"Disable Coupon"),e(),t(59,"th",21),n(60,"Actions"),e(),t(61,"th",21),n(62,"Audit Logs"),e()()(),t(63,"tbody"),_(64,Z,40,20,"tr",22)(65,ee,3,0,"tr",23),e()()(),_(66,ae,64,7,"div",24)(67,de,35,4,"div",25),e()),r&2&&(o(7),u("formGroup",a.filterForm),o(57),u("ngForOf",a.filteredCoupons),o(),u("ngIf",a.filteredCoupons.length===0),o(),u("ngIf",a.showForm),o(),u("ngIf",a.showAuditModal&&a.selectedAudit))},dependencies:[M,F,I,O,Y,N,j,$,A,R,P,q,L,D,k,B,z,U,G,K],encapsulation:2})};export{J as PromoManagementComponent};
